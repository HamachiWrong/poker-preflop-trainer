# Poker Preflop Trainer（ブラウザ版）— 要件定義（Requirements.md）

## 1. 概要
- スマホ最適化の**プリフロップ練習ゲーム**をブラウザで提供する。
- 毎問ランダムに「シナリオ（RFI または VsOpen）・ポジション・相手ポジション・ハンド」を提示し、ユーザーが **Raise / Call / Fold** を選ぶ。
- 正誤判定は**頻度を無視**し、「セルに含まれるアクションの集合（R/C/F）」で行う。

## 2. 入力データ
- 使用ファイル：**`Preflop_Ranges_Final.xlsx`**
  - シート構成：`Legend` / `RFI` / `VsOpen` / `Import_Long` / `Import_Long_Mixed`
  - 本ゲームの判定で参照するのは **`RFI` と `VsOpen`**（13×13のグリッド）。
  - **RFI** のセルは `R` / `F` / `R/F`（Callは無効）
  - **VsOpen** のセルは `R` / `C` / `F` / `R/C` / `R/F` / `R/C/F`
  - セル内パーセンテージ（例 `R70/C30`）があっても、**ゲームの判定では使用しない**（集合として解釈）。
- レンジ表仕様（13×13）
  - 行・列ヘッダ：`A K Q J T 9 8 7 6 5 4 3 2`
  - 対角：ペア（AA, KK, …）、上三角：**スート（AKs）**、下三角：**オフ（AKo）**
  - セルは `/` 区切りで複数アクション可（例：`R/C`, `R/F`, `R/C/F`）

## 3. シナリオ
- **RFI（未オープン）**：`hero ∈ {UTG,HJ,CO,BTN,SB}`、`opener=''`、解答は `Raise or Fold`。
- **VsOpen（対オープン）**：`hero ∈ {HJ,CO,BTN,SB,BB}`、`opener ∈ {UTG,HJ,CO,BTN,SB}`（前位のみ）
  - 対象 15 マッチアップ：
    - UTG を相手：HJ/CO/BTN/SB/BB vs UTG（5）
    - HJ を相手：CO/BTN/SB/BB vs HJ（4）
    - CO を相手：BTN/SB/BB vs CO（3）
    - BTN を相手：SB/BB vs BTN（2）
    - SB を相手：BB vs SB（1）

## 4. ゲームフロー
1. モード選択：`RFI` / `VsOpen` / 両方
2. 問題生成：シナリオ・ポジション・ハンドをランダム選択（弱点重み付けオプションあり）
3. 回答ボタン：
   - RFI：`Raise` / `Fold`
   - VsOpen：`3bet (Raise)` / `Call` / `Fold`
4. 判定：ユーザー選択 ∈ 許可アクション集合（セルの内容を `/` で分割して得る）
5. フィードバック：正誤表示。**不正解時は該当ブロックの169表をポップアップ**し、セルをハイライト。
6. スコア：正答率・連続正解・履歴（ローカル保存）。弱点に重み付け可能。

## 5. UI/画面
- プレイ画面：上部にシナリオ（例：**HJ vs UTG / KJs**）、中央に解答ボタン、下部に「レンジを見る」。
- レンジポップアップ：169表（R=赤, C=緑, F=青）＋現在セルの枠線ハイライト。
- 設定：出題範囲・モード切替・配色・効果音・重み付けON/OFF。
- 成績：ポジション×ハンドの正答率ヒートマップ。

## 6. 非機能要件
- モバイル最適化（片手操作・タップ大きめ）
- オフライン（PWA）※任意
- パフォーマンス：初回ロード < 2.5s（4G想定）、表描画 16ms 以内
- アクセシビリティ：コントラスト、フォーカス、キーボード操作対応
- セキュリティ/プライバシー：Excelは**ローカルで処理**。サーバ送信しない設計を推奨。

## 7. 受け入れ基準（抜粋）
- `Preflop_Ranges_Final.xlsx` を読み込むと、RFI/VsOpen の許可集合が正しく構築される。
- 代表例：
  - **AKo (VsOpen)** → セルが `R/C` なら **Raise/Call が正解**、Fold は不正解。
  - **A3s (VsOpen)** → セルが `R/F` なら **Raise/Fold が正解**、Call は不正解。
  - **KK（任意シナリオ）** → **Fold は常に不正解**（サニティチェック）。
- 不正解時に169表が開き、該当セルがハイライトされる。
- 弱点重み付けONで誤答セルの出題率が上がる。

## 8. 制約・前提
- 判定は**集合ベース**（R/C/F の存在）で、**頻度は使用しない**。
- Excelセルが不正・空の場合は**自動でFold扱いにしない**。警告を表示し、出題から除外するのが望ましい。
- RFI は `R`/`F` のみ（`C`は無視）。VsOpen は `R`/`C`/`F`。
